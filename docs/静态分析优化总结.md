# é™æ€åˆ†æä¼˜åŒ–æ€»ç»“

## ğŸ“… å®æ–½æ—¥æœŸ
2026-01-24

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³é™æ€åˆ†æä¸­çš„ä¸‰ä¸ªé—®é¢˜ï¼š
1. å‰ç«¯æ–‡ä»¶ä¸éœ€è¦æå–ä¾èµ–åˆ—è¡¨
2. å‰ç«¯æ–‡ä»¶ä¸éœ€è¦æå–å‡½æ•°ç¬¦å·è¡¨
3. WebSocketåº”ç”¨çš„äº‹ä»¶ç›‘å¬å™¨æ— æ³•è¯†åˆ«

---

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1ï¸âƒ£ ç®€åŒ–å‰ç«¯åˆ†æ - è·³è¿‡ä¾èµ–æå–

**ä¿®æ”¹ä½ç½®ï¼š** `analyze_js_like_file` å‡½æ•°å¼€å¤´

**åˆ¤æ–­é€»è¾‘ï¼š**
```python
# åˆ¤æ–­æ˜¯å¦æ˜¯å‰ç«¯æ–‡ä»¶
is_frontend_path = any(part in {'frontend', 'client', 'ui', 'web', 'public', 'src'} for part in Path(file_path).parts)
ext = Path(file_path).suffix.lower()
is_frontend = is_frontend_path or ext in {'.jsx', '.tsx', '.vue'}

# å‰ç«¯æ–‡ä»¶ï¼šåªéœ€è¦æ ‡ç­¾ï¼Œä¸éœ€è¦ä¾èµ–å’Œç¬¦å·è¡¨
if is_frontend:
    return {
        "rel_path": rel_path,
        "tags": tags,
        "dependencies": [],
        "entry_points": [],
        "symbols": [],
    }
```

**åŸå› ï¼š**
- å‰ç«¯ä¾èµ–ç”±æ‰“åŒ…å·¥å…·ï¼ˆwebpack/viteï¼‰å¤„ç†ï¼Œä¸æ˜¯Architectå…³å¿ƒçš„
- å‰ç«¯è¿ç§»ä¸»è¦æ˜¯ä¿®æ”¹APIè°ƒç”¨å’Œé…ç½®ï¼Œä¸å…³å¿ƒç»„ä»¶ä¾èµ–å…³ç³»
- **å‡å°‘ä¸å¿…è¦çš„åˆ†æå¼€é”€**

**æ•ˆæœï¼š**
- âœ… å‰ç«¯æ–‡ä»¶çš„ä¾èµ–åˆ—è¡¨ä¸ºç©ºï¼š`"frontend/src/App.js": []`
- âœ… å‰ç«¯æ–‡ä»¶çš„æ ‡ç­¾ä»ç„¶æ­£ç¡®ï¼š`Frontend_API_Consumer`, `Hardcoded_URL`
- âœ… æ€§èƒ½æå‡ï¼šè·³è¿‡å‰ç«¯æ–‡ä»¶çš„å¤æ‚æ­£åˆ™åŒ¹é…

---

### 2ï¸âƒ£ ç®€åŒ–å‰ç«¯åˆ†æ - è·³è¿‡ç¬¦å·è¡¨æå–

**ä¿®æ”¹ä½ç½®ï¼š** åŒä¸Šï¼Œåœ¨å‰ç«¯åˆ¤æ–­å¤„æå‰è¿”å›

**åŸå› ï¼š**
- å‰ç«¯ç»„ä»¶ä¸ä¼šè¢«æ‹†åˆ†æˆç‹¬ç«‹çš„Lambda
- Architectä¸å…³å¿ƒå‰ç«¯å‡½æ•°ç»“æ„
- åªéœ€è¦çŸ¥é“å“ªäº›æ–‡ä»¶è°ƒç”¨äº†APIï¼ˆå·²æœ‰æ ‡ç­¾ï¼š`Frontend_API_Consumer`ï¼‰

**æ•ˆæœï¼š**
- âœ… ç¬¦å·è¡¨åªåŒ…å«åç«¯æ–‡ä»¶ï¼š
  ```json
  "symbol_table": [
    {
      "id": "backend.routes.todo.GET__item",
      "file_path": "backend/routes/todo.js",
      ...
    }
  ]
  ```
- âœ… æ— å‰ç«¯æ–‡ä»¶ç¬¦å·ï¼ˆä¹‹å‰ä¼šæœ‰å¾ˆå¤šæ— ç”¨çš„Reactç»„ä»¶å‡½æ•°ï¼‰

---

### 3ï¸âƒ£ å¢å¼ºåç«¯åˆ†æ - æ·»åŠ WebSocketäº‹ä»¶ç›‘å¬å™¨è¯†åˆ«

**ä¿®æ”¹ä½ç½®ï¼š** `analyze_js_like_file` å‡½æ•°çš„ `patterns` å­—å…¸å’ŒåŒ¹é…é€»è¾‘

**æ–°å¢æ¨¡å¼ï¼š**
```python
# WebSocket/EventEmitteräº‹ä»¶ç›‘å¬å™¨: .on('event', callback)
"event_listener": re.compile(
    r"^\s*([A-Za-z0-9_$]+)\.on\s*\(\s*['\"]([^'\"]+)['\"]"
),
```

**åŒ¹é…é€»è¾‘ï¼š**
```python
elif m := patterns["event_listener"].search(line):
    # WebSocket/EventEmitteräº‹ä»¶ç›‘å¬å™¨
    # ä¾‹å¦‚: wss.on('connection', ...) -> wss_on_connection
    #      ws.on('message', ...) -> ws_on_message
    obj_name = m.group(1)
    event_name = m.group(2)
    name = f"{obj_name}_on_{event_name}"
    kind = "event_handler"
```

**èƒ½è¯†åˆ«çš„æ¨¡å¼ï¼š**
- `wss.on('connection', ...)` â†’ `wss_on_connection`
- `ws.on('message', ...)` â†’ `ws_on_message`
- `ws.on('close', ...)` â†’ `ws_on_close`
- `ws.on('error', ...)` â†’ `ws_on_error`
- `wss.on('listening', ...)` â†’ `wss_on_listening`
- `process.on('SIGINT', ...)` â†’ `process_on_SIGINT`

**æ•ˆæœï¼ˆwebsocketsåº”ç”¨æµ‹è¯•ï¼‰ï¼š**
```json
{
  "symbol_table": [
    {
      "id": "app.wss_on_connection",
      "file_path": "app.js",
      "start_line": 22,
      "end_line": 93,
      "kind": "event_handler"
    },
    {
      "id": "app.ws_on_message",
      "file_path": "app.js",
      "start_line": 34,
      "end_line": 74,
      "kind": "event_handler"
    },
    {
      "id": "app.ws_on_close",
      "file_path": "app.js",
      "start_line": 79,
      "end_line": 83,
      "kind": "event_handler"
    },
    ...
  ]
}
```

âœ… **ä¹‹å‰ï¼š** ç¬¦å·è¡¨ä¸ºç©º `[]`  
âœ… **ç°åœ¨ï¼š** è¯†åˆ«å‡º7ä¸ªäº‹ä»¶å¤„ç†å™¨

---

## ğŸ“Š å¯¹æ¯”æµ‹è¯•ç»“æœ

### WebSocketåº”ç”¨ï¼ˆmono-benchmark/websocketsï¼‰

| é¡¹ç›® | æ”¹è¿›å‰ | æ”¹è¿›å | æ”¹è¿› |
|------|--------|--------|------|
| **ç¬¦å·è¡¨** | 0ä¸ª | 7ä¸ªäº‹ä»¶å¤„ç†å™¨ | âœ… æˆåŠŸè¯†åˆ« |
| **ä¾èµ–** | `["ws"]` | `["ws"]` | âœ… ä¿æŒæ­£ç¡® |
| **å…¥å£ç‚¹** | 0ä¸ª | 0ä¸ª | âœ… ç¬¦åˆé¢„æœŸï¼ˆWebSocketæ— HTTPè·¯ç”±ï¼‰ |

**è¯†åˆ«åˆ°çš„äº‹ä»¶å¤„ç†å™¨ï¼š**
1. `wss_on_connection` - è¿æ¥å»ºç«‹
2. `ws_on_message` - æ¶ˆæ¯æ¥æ”¶
3. `ws_on_close` - è¿æ¥æ–­å¼€
4. `ws_on_error` - è¿æ¥é”™è¯¯
5. `wss_on_listening` - æœåŠ¡å™¨ç›‘å¬
6. `wss_on_error` - æœåŠ¡å™¨é”™è¯¯
7. `process_on_SIGINT` - ä¼˜é›…å…³é—­

---

### Todoåº”ç”¨ï¼ˆmono-benchmark/todoï¼‰

| é¡¹ç›® | æ”¹è¿›å‰ | æ”¹è¿›å | æ”¹è¿› |
|------|--------|--------|------|
| **å‰ç«¯ä¾èµ–** | æœ‰å¤§é‡React/Axiosä¾èµ– | `[]` ç©ºæ•°ç»„ | âœ… æˆåŠŸè·³è¿‡ |
| **å‰ç«¯ç¬¦å·è¡¨** | æœ‰å¤§é‡ç»„ä»¶å‡½æ•° | æ— å‰ç«¯ç¬¦å· | âœ… æˆåŠŸè·³è¿‡ |
| **åç«¯ç¬¦å·è¡¨** | å®Œæ•´ | å®Œæ•´ | âœ… ä¿æŒå®Œæ•´ |
| **å‰ç«¯æ ‡ç­¾** | æ­£ç¡® | æ­£ç¡® | âœ… ä¿æŒæ­£ç¡® |

**å‰ç«¯æ–‡ä»¶å¤„ç†ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰ï¼š**
```json
{
  "frontend/src/App.js": [],
  "frontend/src/config.js": [],
  "frontend/src/index.js": [],
  "frontend/src/serviceWorker.js": [],
  "frontend/src/ToDo.js": []
}
```

**åç«¯ç¬¦å·è¡¨ï¼ˆå®Œæ•´ä¿ç•™ï¼‰ï¼š**
- 6ä¸ªExpressè·¯ç”±å¤„ç†å™¨ï¼ˆtodo.jsï¼‰
- 2ä¸ªè®¤è¯è·¯ç”±å¤„ç†å™¨ï¼ˆauth.jsï¼‰
- å¤šä¸ªå·¥å…·å‡½æ•°ï¼ˆinit-db.js, jwt.jsç­‰ï¼‰

---

## ğŸ¯ ä¼˜åŒ–æ•ˆæœæ€»ç»“

### âœ… åŠŸèƒ½æ€§æ”¹è¿›

1. **WebSocketåº”ç”¨æ”¯æŒ** â­
   - ä¹‹å‰ï¼šæ— æ³•è¯†åˆ«äº‹ä»¶ç›‘å¬å™¨ï¼Œç¬¦å·è¡¨ä¸ºç©º
   - ç°åœ¨ï¼šå®Œæ•´è¯†åˆ«æ‰€æœ‰äº‹ä»¶å¤„ç†å™¨
   - æ„ä¹‰ï¼šä¸ºWebSocketåº”ç”¨çš„serverlessè¿ç§»æä¾›åŸºç¡€ä¿¡æ¯

2. **å‰ç«¯åˆ†æç®€åŒ–** â­
   - è·³è¿‡ä¸å¿…è¦çš„ä¾èµ–æå–
   - è·³è¿‡ä¸å¿…è¦çš„ç¬¦å·è¡¨æå–
   - ä¿ç•™é‡è¦çš„æ ‡ç­¾ä¿¡æ¯ï¼ˆAPIè°ƒç”¨ã€é…ç½®ç­‰ï¼‰

### âœ… æ€§èƒ½æ”¹è¿›

| ä¼˜åŒ–é¡¹ | èŠ‚çœçš„æ“ä½œ |
|--------|-----------|
| è·³è¿‡å‰ç«¯ä¾èµ–æå– | æ¯ä¸ªå‰ç«¯æ–‡ä»¶ï¼š~3æ¬¡æ­£åˆ™åŒ¹é… |
| è·³è¿‡å‰ç«¯ç¬¦å·è¡¨æå– | æ¯ä¸ªå‰ç«¯æ–‡ä»¶ï¼š~8æ¬¡æ­£åˆ™åŒ¹é… + æ‹¬å·åŒ¹é…ç®—æ³• |
| **todoåº”ç”¨ï¼ˆ5ä¸ªå‰ç«¯æ–‡ä»¶ï¼‰** | **~55æ¬¡æ­£åˆ™åŒ¹é…æ“ä½œ** |

### âœ… æ•°æ®è´¨é‡æ”¹è¿›

**ä¹‹å‰çš„é—®é¢˜ï¼š**
- âŒ å‰ç«¯ä¾èµ–æ··æ‚åœ¨dependency_graphä¸­ï¼Œå¹²æ‰°Architectåˆ†æ
- âŒ å‰ç«¯ç»„ä»¶å‡½æ•°æ··æ‚åœ¨ç¬¦å·è¡¨ä¸­ï¼Œå¹²æ‰°Lambdaæ‹†åˆ†å†³ç­–
- âŒ WebSocketåº”ç”¨æ— ç¬¦å·ä¿¡æ¯ï¼Œæ— æ³•è¿›è¡Œæ¶æ„è®¾è®¡

**ç°åœ¨ï¼š**
- âœ… dependency_graphåªåŒ…å«åç«¯ä¾èµ–ï¼ˆç”¨äºç¡®å®šLambdaçš„package.jsonï¼‰
- âœ… ç¬¦å·è¡¨åªåŒ…å«åç«¯å‡½æ•°ï¼ˆç”¨äºLambdaæ‹†åˆ†ï¼‰
- âœ… WebSocketåº”ç”¨æœ‰å®Œæ•´çš„äº‹ä»¶å¤„ç†å™¨ä¿¡æ¯

---

## ğŸ“ handler: async å­—æ®µè¯´æ˜

**å«ä¹‰ï¼š** è¡¨ç¤ºExpressè·¯ç”±å¤„ç†å‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°

**ç¤ºä¾‹ï¼š**
```javascript
router.get('/item', async (req, res) => {
  // asyncå‡½æ•°
});
```

**åœ¨åˆ†æç»“æœä¸­ï¼š**
```json
{
  "file": "backend/routes/todo.js",
  "method": "GET",
  "path": "/item",
  "handler": "async"  // æ ‡è¯†è¿™æ˜¯asyncå‡½æ•°
}
```

**ç”¨é€”ï¼š**
- âœ… å¸®åŠ©Coding AgentçŸ¥é“è½¬æ¢åçš„Lambdaéœ€è¦async/awaitå¤„ç†
- âœ… Lambdaå‡½æ•°å¤©ç„¶æ”¯æŒasyncï¼Œè¿™ä¸ªæ ‡è®°æœ‰åŠ©äºä»£ç è½¬æ¢

---

## ğŸ“ è®¾è®¡åŸåˆ™æ€»ç»“

### åŸåˆ™1ï¼šèŒè´£åˆ†ç¦»
- **å‰ç«¯æ–‡ä»¶**ï¼šåªéœ€æ ‡ç­¾ï¼ˆç”¨äºè¯†åˆ«éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰
- **åç«¯æ–‡ä»¶**ï¼šéœ€è¦å®Œæ•´åˆ†æï¼ˆä¾èµ–ã€ç¬¦å·è¡¨ã€å…¥å£ç‚¹ï¼‰

### åŸåˆ™2ï¼šæ€§èƒ½ä¼˜å…ˆ
- è·³è¿‡ä¸å¿…è¦çš„åˆ†æï¼Œå‡å°‘æ­£åˆ™åŒ¹é…æ“ä½œ
- æå‰è¿”å›ï¼Œé¿å…æ‰§è¡Œå¤æ‚çš„ç¬¦å·è¡¨æå–é€»è¾‘

### åŸåˆ™3ï¼šæ‰©å±•æ€§
- äº‹ä»¶é©±åŠ¨æ¨¡å¼è¯†åˆ«ï¼ˆWebSocket, EventEmitterï¼‰
- ä¸ºä¸åŒçš„å‡½æ•°ç±»å‹æ·»åŠ kindæ ‡è®°ï¼š
  - `function` - æ™®é€šå‡½æ•°
  - `class` - ç±»å®šä¹‰
  - `route_handler` - Expressè·¯ç”±å¤„ç†å™¨
  - `event_handler` - äº‹ä»¶ç›‘å¬å™¨ï¼ˆæ–°å¢ï¼‰

---

## ğŸš€ æœªæ¥å¯èƒ½çš„ä¼˜åŒ–

### ä¼˜åŒ–1ï¼šæ›´ç²¾ç¡®çš„å‰ç«¯åˆ¤æ–­

å½“å‰åˆ¤æ–­é€»è¾‘ï¼šè·¯å¾„åŒ…å« `frontend/client/ui/web/public/src`

**é—®é¢˜ï¼š** `src` å¤ªå®½æ³›ï¼Œå¯èƒ½è¯¯åˆ¤åç«¯çš„ `src` ç›®å½•

**æ”¹è¿›ï¼š**
```python
# æ›´ç²¾ç¡®çš„åˆ¤æ–­ï¼šç»“åˆè·¯å¾„+æ–‡ä»¶ç‰¹å¾
if 'frontend' in parts or 'client' in parts:
    is_frontend = True
elif ext in {'.jsx', '.tsx', '.vue'}:
    is_frontend = True
elif 'src' in parts and any(tag.startswith('Frontend_') for tag in tags):
    is_frontend = True
```

### ä¼˜åŒ–2ï¼šæ›´å¤šäº‹ä»¶é©±åŠ¨æ¨¡å¼

æ‰©å±•è¯†åˆ«å…¶ä»–äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼š
- `.addEventListener('event', ...)` - æµè§ˆå™¨äº‹ä»¶
- `.subscribe('event', ...)` - RxJS/EventBus
- `.then(callback)` / `.catch(callback)` - Promiseé“¾

### ä¼˜åŒ–3ï¼škindå­—æ®µå¢å¼º

ä¸ºä¸åŒç±»å‹çš„å‡½æ•°æä¾›æ›´å¤šå…ƒæ•°æ®ï¼š
```json
{
  "id": "app.wss_on_connection",
  "kind": "event_handler",
  "event_source": "wss",
  "event_type": "connection",
  "is_async": false
}
```

---

## âœ¨ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼š

1. âœ… **è§£å†³äº†WebSocketåº”ç”¨ç¬¦å·è¡¨ä¸ºç©ºçš„é—®é¢˜**
2. âœ… **ç®€åŒ–äº†å‰ç«¯åˆ†æï¼Œæå‡äº†æ€§èƒ½**
3. âœ… **æé«˜äº†åˆ†æç»“æœçš„æ•°æ®è´¨é‡**
4. âœ… **ä¸ºä¸åŒåº”ç”¨æ¶æ„æä¾›äº†æ›´å¥½çš„æ”¯æŒ**

ç°åœ¨é™æ€åˆ†æè„šæœ¬èƒ½å¤Ÿæ›´æ™ºèƒ½åœ°åŒºåˆ†å‰ç«¯/åç«¯ï¼Œæ›´å‡†ç¡®åœ°è¯†åˆ«ä¸åŒçš„ä»£ç æ¨¡å¼ï¼ğŸ‰
