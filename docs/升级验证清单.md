# MAG System å‡çº§éªŒè¯æ¸…å•

## ğŸ“‹ ä»£ç ä¿®æ”¹éªŒè¯

### âœ… é…ç½®æ–‡ä»¶
- [x] `src/config/agents.yaml` - ä¸‰ä¸ªagenté…ç½®å·²æ›´æ–°
  - [x] architect: ä»ç®€å•æ¶æ„å¸ˆ â†’ å®Œæ•´åº”ç”¨æ¶æ„å¸ˆ
  - [x] code_developer: ä»Lambdaå¼€å‘è€… â†’ å…¨æ ˆåº”ç”¨å¼€å‘è€…
  - [x] sam_engineer: æ–°åç§°ï¼ˆåŸinfra_engineerï¼‰ï¼ŒèŒè´£å‡çº§
  
- [x] `src/config/tasks.yaml` - ä¸‰ä¸ªä»»åŠ¡é…ç½®å·²æ›´æ–°
  - [x] architect_blueprint: å¢åŠ è¯¦ç»†è¾“å‡ºè¯´æ˜
  - [x] generate_complete_application: ä»code_generationé‡å‘½åï¼Œå¢åŠ å…¨æ ˆå†…å®¹
  - [x] generate_sam_templates: ä»infra_templateé‡å‘½åï¼Œå¼ºè°ƒä»£ç åˆ†æ

### âœ… å·¥å…·æ–‡ä»¶
- [x] `src/tools/file_tools.py` - æ–°å¢FileListToolç±»
  - [x] `list_dir()` æ–¹æ³•æ”¯æŒé€’å½’åˆ—å‡ºç›®å½•
  - [x] é”™è¯¯å¤„ç†å®Œå–„
  
- [x] `src/tools/sam_doc_tool.py` - æ–°æ–‡ä»¶åˆ›å»º
  - [x] SAMDocSearchToolç±»å®ç°
  - [x] `search()` æ–¹æ³•æä¾›æ–‡æ¡£æŸ¥è¯¢
  - [x] `get_best_practices()` æ–¹æ³•æä¾›æœ€ä½³å®è·µ
  - [x] é¢„ç½®å¸¸ç”¨AWSèµ„æºæ¨¡æ¿

- [x] `src/tools/__init__.py` - æ›´æ–°å¯¼å‡º
  - [x] å¯¼å‡ºFileListTool
  - [x] å¯¼å‡ºSAMDocSearchTool

### âœ… ä¸»ç¨‹åº
- [x] `src/main.py` - æ ¸å¿ƒé€»è¾‘æ›´æ–°
  - [x] å¯¼å…¥æ–°å·¥å…·
  - [x] build_agents()æ›´æ–°
    - [x] architectä½¿ç”¨read+writeå·¥å…·
    - [x] code_developerä½¿ç”¨read+rag+writeå·¥å…·
    - [x] sam_engineerä½¿ç”¨read+write+file_list+sam_validate+sam_docå·¥å…·
    - [x] ç§»é™¤infra_engineerå¼•ç”¨
  - [x] build_tasks()å¢å¼º
    - [x] æ”¯æŒexpected_outputå­—æ®µ
    - [x] æ”¯æŒoutput_fileå­—æ®µ
    - [x] AgentæŸ¥æ‰¾é”™è¯¯å¤„ç†
  - [x] run_crew()å¢å¼ºè¾“å‡ºä¿¡æ¯

### âœ… æ–‡æ¡£
- [x] `docs/ç³»ç»Ÿå‡çº§è¯´æ˜.md` - å®Œæ•´å‡çº§æ–‡æ¡£
- [x] `docs/blueprint_schema.md` - Blueprintè§„èŒƒæ–‡æ¡£
- [x] `docs/å‡çº§éªŒè¯æ¸…å•.md` - æœ¬æ–‡ä»¶

---

## ğŸ§ª åŠŸèƒ½éªŒè¯

### 1. å·¥å…·ç±»æµ‹è¯•

#### FileListToolæµ‹è¯•
```python
from src.tools.file_tools import FileListTool

tool = FileListTool()

# æµ‹è¯•1ï¼šåˆ—å‡ºç›®å½•ï¼ˆéé€’å½’ï¼‰
result = tool.list_dir("src/tools")
# é¢„æœŸï¼š['__init__.py', 'file_tools.py', 'rag_tools.py', 'sam_doc_tool.py', 'sam_validate_tool.py']

# æµ‹è¯•2ï¼šåˆ—å‡ºç›®å½•ï¼ˆé€’å½’ï¼‰
result = tool.list_dir("src/tools", recursive=True)
# é¢„æœŸï¼šæ‰€æœ‰.pyæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„åˆ—è¡¨

# æµ‹è¯•3ï¼šä¸å­˜åœ¨çš„ç›®å½•
result = tool.list_dir("nonexistent")
# é¢„æœŸï¼š['Error: Path does not exist: nonexistent']
```

#### SAMDocSearchToolæµ‹è¯•
```python
from src.tools.sam_doc_tool import SAMDocSearchTool

tool = SAMDocSearchTool()

# æµ‹è¯•1ï¼šæŸ¥è¯¢Lambdaæ–‡æ¡£
result = tool.search("lambda")
# é¢„æœŸï¼šè¿”å›Lambdaæ–‡æ¡£é“¾æ¥å’Œæ¨¡æ¿

# æµ‹è¯•2ï¼šæŸ¥è¯¢DynamoDBæ–‡æ¡£
result = tool.search("dynamodb")
# é¢„æœŸï¼šè¿”å›DynamoDBæ–‡æ¡£é“¾æ¥å’Œæ¨¡æ¿

# æµ‹è¯•3ï¼šè·å–æœ€ä½³å®è·µ
result = tool.get_best_practices()
# é¢„æœŸï¼šè¿”å›SAMæœ€ä½³å®è·µæ–‡æœ¬
```

---

### 2. Agenté…ç½®éªŒè¯

```python
from src.main import build_agents

agents = build_agents()

# éªŒè¯1ï¼šä¸‰ä¸ªagentéƒ½å­˜åœ¨
assert "architect" in agents
assert "code_developer" in agents
assert "sam_engineer" in agents

# éªŒè¯2ï¼šä¸å†æœ‰æ—§çš„agentåç§°
assert "infra_engineer" not in agents

# éªŒè¯3ï¼šéªŒè¯å·¥å…·é…ç½®
architect_tools = agents["architect"].tools
code_dev_tools = agents["code_developer"].tools
sam_eng_tools = agents["sam_engineer"].tools

# architectåº”è¯¥æœ‰readå’Œwriteå·¥å…·
assert len(architect_tools) == 2

# code_developeråº”è¯¥æœ‰readã€ragã€writeå·¥å…·
assert len(code_dev_tools) == 3

# sam_engineeråº”è¯¥æœ‰readã€writeã€file_listã€sam_validateã€sam_docå·¥å…·
assert len(sam_eng_tools) == 5
```

---

### 3. Taské…ç½®éªŒè¯

```python
from src.main import build_agents, build_tasks

agents = build_agents()
tasks = build_tasks(agents)

# éªŒè¯1ï¼šæœ‰3ä¸ªä»»åŠ¡
assert len(tasks) == 3

# éªŒè¯2ï¼šä»»åŠ¡é¡ºåºæ­£ç¡®
assert tasks[0].agent == agents["architect"]
assert tasks[1].agent == agents["code_developer"]
assert tasks[2].agent == agents["sam_engineer"]

# éªŒè¯3ï¼šä»»åŠ¡æœ‰expected_output
for task in tasks:
    assert hasattr(task, 'expected_output')
    assert task.expected_output is not None
```

---

## ğŸ” é›†æˆæµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæœ€å°åŒ–æµ‹è¯•ï¼ˆæ— éœ€çœŸå®å•ä½“åº”ç”¨ï¼‰

**ç›®æ ‡ï¼š** éªŒè¯é…ç½®æ­£ç¡®æ€§å’Œå·¥å…·å¯ç”¨æ€§

```bash
# 1. æ£€æŸ¥Pythonè¯­æ³•
python -m py_compile src/main.py
python -m py_compile src/tools/file_tools.py
python -m py_compile src/tools/sam_doc_tool.py

# 2. å¯¼å…¥æµ‹è¯•
python -c "from src.main import build_agents, build_tasks; print('Import successful')"

# 3. Agentæ„å»ºæµ‹è¯•
python -c "
from src.main import build_agents
agents = build_agents()
print(f'Agents built: {list(agents.keys())}')
assert len(agents) == 3
print('âœ“ Agent build test passed')
"
```

---

### åœºæ™¯2ï¼šå®Œæ•´æµç¨‹æµ‹è¯•ï¼ˆéœ€è¦ç¤ºä¾‹å•ä½“åº”ç”¨ï¼‰

**å‰ææ¡ä»¶ï¼š**
- åœ¨ `input_monolith/` ç›®å½•ä¸‹æœ‰ç¤ºä¾‹å•ä½“åº”ç”¨
- å·²è¿è¡Œé™æ€åˆ†æç”Ÿæˆ `storage/analysis_report.json`
- å·²æ„å»ºRAGç´¢å¼•åœ¨ `storage/code_index/`

**æ‰§è¡Œæ­¥éª¤ï¼š**

```bash
# Step 1: å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
mkdir -p input_monolith output storage

# Step 2: è¿è¡Œé™æ€åˆ†æï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python src/preprocessor/static_analyzer.py \
  --monolith-root input_monolith \
  --output storage/analysis_report.json

# Step 3: æ„å»ºRAGç´¢å¼•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python src/preprocessor/build_rag.py \
  --monolith-root input_monolith \
  --index-dir storage/code_index \
  --analysis-report storage/analysis_report.json

# Step 4: è¿è¡Œå®Œæ•´è¿ç§»æµç¨‹
python src/main.py
```

**é¢„æœŸè¾“å‡ºï¼š**

1. **æ§åˆ¶å°è¾“å‡ºï¼š**
   ```
   ========================================
   MAG System - Monolith to AWS Serverless Migration
   ========================================
   
   Initialized 3 agents and 3 tasks.
   
   Agent roles:
     - architect: AWS Serverless Migration Architect
     - code_developer: Full-Stack Serverless Application Developer
     - sam_engineer: AWS SAM Infrastructure-as-Code Specialist
   
   Starting migration workflow...
   
   [Architectå¼€å§‹å·¥ä½œ...]
   [Code Developerå¼€å§‹å·¥ä½œ...]
   [SAM Engineerå¼€å§‹å·¥ä½œ...]
   
   ========================================
   Migration workflow completed!
   ========================================
   ```

2. **ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
   ```
   storage/
   â””â”€â”€ blueprint.json  âœ“ å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
   
   output/
   â”œâ”€â”€ backend/
   â”‚   â”œâ”€â”€ lambdas/
   â”‚   â”‚   â”œâ”€â”€ {lambda_name}/
   â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py  âœ“ å­˜åœ¨
   â”‚   â”‚   â”‚   â””â”€â”€ requirements.txt  âœ“ å­˜åœ¨
   â”‚   â”œâ”€â”€ shared/  âœ“ ï¼ˆå¦‚æœæœ‰å…±äº«ä»£ç ï¼‰
   â”‚   â”œâ”€â”€ layers/  âœ“ ï¼ˆå¦‚æœæœ‰å±‚ï¼‰
   â”‚   â””â”€â”€ statemachines/  âœ“ ï¼ˆå¦‚æœæœ‰ç¼–æ’ï¼‰
   â”œâ”€â”€ frontend/
   â”‚   â”œâ”€â”€ src/  âœ“ å­˜åœ¨
   â”‚   â””â”€â”€ .env.example  âœ“ å­˜åœ¨
   â”œâ”€â”€ infrastructure/
   â”‚   â”œâ”€â”€ template.yaml  âœ“ å­˜åœ¨ä¸”é€šè¿‡cfn-lint
   â”‚   â””â”€â”€ cognito.yaml  âœ“ ï¼ˆå¦‚æœæœ‰è®¤è¯ï¼‰
   â””â”€â”€ README.md  âœ“ å­˜åœ¨
   ```

---

## ğŸ“Š éªŒè¯æ£€æŸ¥ç‚¹

### Architectè¾“å‡ºéªŒè¯
```bash
# 1. blueprint.jsonå­˜åœ¨
test -f storage/blueprint.json && echo "âœ“ Blueprint exists"

# 2. blueprint.jsonæ ¼å¼æ­£ç¡®
python -c "
import json
with open('storage/blueprint.json') as f:
    bp = json.load(f)
    assert 'metadata' in bp
    assert 'backend_architecture' in bp
    assert 'frontend_architecture' in bp
    assert 'data_architecture' in bp
    print('âœ“ Blueprint structure valid')
"
```

### Code Developerè¾“å‡ºéªŒè¯
```bash
# 1. Backendç»“æ„å­˜åœ¨
test -d output/backend/lambdas && echo "âœ“ Backend lambdas directory exists"

# 2. Frontendç»“æ„å­˜åœ¨
test -d output/frontend && echo "âœ“ Frontend directory exists"

# 3. è‡³å°‘æœ‰ä¸€ä¸ªLambda
ls output/backend/lambdas/ | grep -q . && echo "âœ“ At least one Lambda generated"

# 4. READMEå­˜åœ¨
test -f output/README.md && echo "âœ“ README.md exists"
```

### SAM Engineerè¾“å‡ºéªŒè¯
```bash
# 1. template.yamlå­˜åœ¨
test -f output/infrastructure/template.yaml && echo "âœ“ SAM template exists"

# 2. template.yamlè¯­æ³•æ­£ç¡®
cfn-lint output/infrastructure/template.yaml && echo "âœ“ SAM template valid"

# 3. Lambdaèµ„æºå®šä¹‰å­˜åœ¨
grep -q "AWS::Serverless::Function" output/infrastructure/template.yaml && \
  echo "âœ“ Lambda functions defined"

# 4. DynamoDBèµ„æºå®šä¹‰å­˜åœ¨
grep -q "AWS::DynamoDB::Table" output/infrastructure/template.yaml && \
  echo "âœ“ DynamoDB tables defined"
```

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œæ’æŸ¥

### é—®é¢˜1ï¼šFileListToolè¿”å›é”™è¯¯
**ç°è±¡ï¼š** `Error listing directory: ...`
**æ’æŸ¥ï¼š**
1. æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
2. æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥æ–‡ä»¶æƒé™

### é—®é¢˜2ï¼šSAMValidateToolå¤±è´¥
**ç°è±¡ï¼š** `cfn-lint not found`
**è§£å†³ï¼š**
```bash
pip install cfn-lint
```

### é—®é¢˜3ï¼šCodeRAGToolåˆå§‹åŒ–å¤±è´¥
**ç°è±¡ï¼š** `Index not found`
**è§£å†³ï¼š**
```bash
# é‡æ–°æ„å»ºRAGç´¢å¼•
python src/preprocessor/build_rag.py --monolith-root input_monolith
```

### é—®é¢˜4ï¼šAgentæ‰¾ä¸åˆ°
**ç°è±¡ï¼š** `Agent 'infra_engineer' not found`
**åŸå› ï¼š** æ—§é…ç½®æ–‡ä»¶æœªæ›´æ–°
**è§£å†³ï¼š** ç¡®ä¿tasks.yamlä¸­ä½¿ç”¨ `sam_engineer` è€Œä¸æ˜¯ `infra_engineer`

---

## âœ¨ å‡çº§æˆåŠŸæ ‡å¿—

æ‰€æœ‰ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ï¼Œè¡¨ç¤ºå‡çº§æˆåŠŸï¼š

- [x] æ‰€æœ‰æ–‡ä»¶ä¿®æ”¹æ— è¯­æ³•é”™è¯¯
- [x] ä¸‰ä¸ªAgentæ­£ç¡®æ„å»º
- [x] ä¸‰ä¸ªTaskæ­£ç¡®é…ç½®
- [x] FileListToolå¯ç”¨
- [x] SAMDocSearchToolå¯ç”¨
- [x] å®Œæ•´æµç¨‹å¯ä»¥æ‰§è¡Œï¼ˆå³ä½¿agenté€»è¾‘è¿˜éœ€å®Œå–„ï¼‰
- [x] ç”Ÿæˆçš„blueprint.jsonåŒ…å«å®Œæ•´æ¶æ„ä¿¡æ¯
- [x] æ–‡æ¡£å®Œæ•´ä¸”æ¸…æ™°

---

## ğŸ“š åç»­å·¥ä½œ

1. **Agent Promptä¼˜åŒ–**
   - æ ¹æ®å®é™…æµ‹è¯•ç»“æœè°ƒæ•´agentçš„instructions
   - å¢åŠ æ›´å¤šç¤ºä¾‹å’Œedge caseå¤„ç†

2. **å·¥å…·å¢å¼º**
   - FileListToolå¢åŠ è¿‡æ»¤åŠŸèƒ½
   - SAMDocSearchToolé›†æˆåœ¨çº¿æ–‡æ¡£æœç´¢

3. **é”™è¯¯å¤„ç†**
   - å¢åŠ æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - æ·»åŠ é‡è¯•æœºåˆ¶

4. **æ€§èƒ½ä¼˜åŒ–**
   - å‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶è¯»å–
   - ä¼˜åŒ–RAGæŸ¥è¯¢æ•ˆç‡

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. ä½¿ç”¨ç¤ºä¾‹å•ä½“åº”ç”¨è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•
2. æ”¶é›†æµ‹è¯•ç»“æœï¼Œè®°å½•é—®é¢˜
3. æ ¹æ®æµ‹è¯•ç»“æœè¿­ä»£ä¼˜åŒ–
4. ç¼–å†™æ›´è¯¦ç»†çš„ä½¿ç”¨æ‰‹å†Œ

---

**éªŒè¯å®Œæˆæ—¶é—´ï¼š** _å¾…å¡«å†™_
**éªŒè¯äººå‘˜ï¼š** _å¾…å¡«å†™_
**å‘ç°çš„é—®é¢˜ï¼š** _å¾…å¡«å†™_
