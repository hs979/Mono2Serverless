{
  "backend_architecture": {
    "lambda_functions": {
      "product_domain": [
        {
          "name": "GetProductsFunction",
          "description": "Retrieves list of products",
          "source": "backend/app.py:get_products",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:Query", "dynamodb:Scan"]
        },
        {
          "name": "GetProductFunction",
          "description": "Retrieves single product by ID",
          "source": "backend/app.py:get_product",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:GetItem"]
        }
      ],
      "cart_domain": [
        {
          "name": "ListCartFunction",
          "description": "Lists cart items for a user or anonymous cart",
          "source": "backend/app.py:list_cart",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:Query"]
        },
        {
          "name": "AddToCartFunction",
          "description": "Adds or updates item in cart",
          "source": "backend/app.py:add_to_cart",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:UpdateItem", "dynamodb:DeleteItem"]
        },
        {
          "name": "UpdateCartFunction",
          "description": "Updates cart item quantity (idempotent)",
          "source": "backend/app.py:update_cart",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:PutItem", "dynamodb:DeleteItem"]
        },
        {
          "name": "MigrateCartFunction",
          "description": "Migrates anonymous cart to user account",
          "source": "backend/app.py:migrate_cart",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:Query", "dynamodb:GetItem", "dynamodb:UpdateItem", "dynamodb:PutItem", "dynamodb:BatchWriteItem"]
        },
        {
          "name": "GetCartTotalFunction",
          "description": "Gets total quantity for a specific product in cart",
          "source": "backend/app.py:get_cart_total",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith"
          },
          "permissions": ["dynamodb:GetItem"]
        }
      ],
      "order_domain": [
        {
          "name": "CheckoutCartFunction",
          "description": "Initiates checkout process (trigger for Step Functions)",
          "source": "backend/app.py:checkout_cart",
          "runtime": "python3.12",
          "environment_variables": {
            "DYNAMODB_TABLE_NAME": "shopping-cart-monolith",
            "STEP_FUNCTION_ARN": "arn:aws:states:us-east-1:123456789012:stateMachine:CheckoutStateMachine"
          },
          "permissions": ["dynamodb:Query", "states:StartExecution"]
        }
      ]
    },
    "step_functions": [
      {
        "name": "CheckoutStateMachine",
        "description": "Orchestrates checkout process: validate cart, process payment, update inventory, send notifications",
        "states": [
          "ValidateCart",
          "ProcessPayment",
          "UpdateInventory",
          "SendConfirmation",
          "HandleFailure"
        ],
        "triggers": ["CheckoutCartFunction"],
        "output": "Order confirmation or error"
      }
    ],
    "shared_lambda_layers": [
      {
        "name": "CommonUtilitiesLayer",
        "description": "Shared utilities for DynamoDB operations, authentication helpers, and serialization",
        "compatible_runtimes": ["python3.12"],
        "content": [
          "backend/db.py",
          "backend/models.py",
          "backend/auth.py"
        ]
      }
    ]
  },
  "frontend_architecture": {
    "migration_required": true,
    "files_requiring_migration": [
      {
        "file": "frontend/vue.config.js",
        "reason": "Contains hardcoded backend URL; needs to be updated to use API Gateway endpoint",
        "new_content_hint": "Replace proxy target with API Gateway URL"
      },
      {
        "file": "frontend/src/aws-exports.js",
        "reason": "AWS Amplify configuration; update with new Cognito User Pool, API Gateway, and region settings",
        "new_content_hint": "Update with Cognito UserPoolId, ClientId, API Gateway endpoint"
      },
      {
        "file": "frontend/src/backend/api.js",
        "reason": "API client; update base URL and authentication headers to use Cognito tokens",
        "new_content_hint": "Replace fetch calls with Amplify API or Axios configured with Cognito auth"
      },
      {
        "file": "frontend/scripts/fetchconfig.js",
        "reason": "Configuration fetcher; may need to adjust for serverless environment",
        "new_content_hint": "Update to fetch from SSM Parameter Store or environment variables"
      }
    ],
    "files_to_copy_unchanged": [
      "frontend/babel.config.js",
      "frontend/src/App.vue",
      "frontend/src/main.js",
      "frontend/src/router.js",
      "frontend/src/components/CartButton.vue",
      "frontend/src/components/CartDrawer.vue",
      "frontend/src/components/CartQuantityEditor.vue",
      "frontend/src/components/LoadingOverlay.vue",
      "frontend/src/components/Product.vue",
      "frontend/src/plugins/vuetify.js",
      "frontend/src/store/actions.js",
      "frontend/src/store/getters.js",
      "frontend/src/store/mutations.js",
      "frontend/src/store/store.js",
      "frontend/src/views/Auth.vue",
      "frontend/src/views/Home.vue",
      "frontend/src/views/Payment.vue",
      "frontend/public/favicon.ico",
      "frontend/public/index.html",
      "frontend/package.json",
      "frontend/package-lock.json",
      "frontend/yarn.lock",
      "frontend/Makefile",
      "frontend/vue.config.js"
    ],
    "new_configuration_files": [
      {
        "file": ".env.example",
        "content_hint": "Environment variables for frontend: VUE_APP_API_ENDPOINT, VUE_APP_COGNITO_USER_POOL_ID, VUE_APP_COGNITO_CLIENT_ID, VUE_APP_REGION"
      },
      {
        "file": "aws-exports.js",
        "content_hint": "AWS Amplify configuration auto-generated by Amplify CLI or manually set with Cognito and API Gateway settings"
      }
    ],
    "deployment_target": "Amazon S3 + CloudFront"
  },
  "data_architecture": {
    "dynamodb_tables": [
      {
        "table_name": "shopping-cart-monolith",
        "description": "Single-table design for users, cart items, and product statistics",
        "key_schema": [
          {
            "attribute_name": "pk",
            "key_type": "HASH"
          },
          {
            "attribute_name": "sk",
            "key_type": "RANGE"
          }
        ],
        "attribute_definitions": [
          {
            "attribute_name": "pk",
            "attribute_type": "S"
          },
          {
            "attribute_name": "sk",
            "attribute_type": "S"
          },
          {
            "attribute_name": "username",
            "attribute_type": "S"
          }
        ],
        "global_secondary_indexes": [
          {
            "index_name": "username-index",
            "key_schema": [
              {
                "attribute_name": "username",
                "key_type": "HASH"
              }
            ],
            "projection": {
              "projection_type": "ALL"
            },
            "provisioned_throughput": {
              "read_capacity_units": 5,
              "write_capacity_units": 5
            }
          }
        ],
        "billing_mode": "PROVISIONED",
        "provisioned_throughput": {
          "read_capacity_units": 5,
          "write_capacity_units": 5
        },
        "time_to_live": {
          "enabled": true,
          "attribute_name": "expirationTime"
        },
        "data_patterns": [
          {
            "entity_type": "user",
            "pk": "USER#{username}",
            "sk": "PROFILE",
            "attributes": ["id", "username", "password_hash", "email", "created_at"]
          },
          {
            "entity_type": "cart_item",
            "pk": "user#{userId} or cart#{cartId}",
            "sk": "product#{productId}",
            "attributes": ["quantity", "product_detail", "expirationTime", "updated_at"]
          },
          {
            "entity_type": "product_statistics",
            "pk": "PRODUCT#{productId}",
            "sk": "TOTAL",
            "attributes": ["total_quantity", "updated_at"]
          }
        ]
      }
    ],
    "table_relationships": "Single-table design uses composite keys to establish relationships: user to cart items (same pk), product statistics separate.",
    "indexes": "GSI on username for user lookup by username."
  },
  "authentication_strategy": {
    "service": "Amazon Cognito User Pools",
    "configuration": {
      "user_pool": {
        "name": "ShoppingCartUserPool",
        "attributes": [
          {
            "name": "email",
            "required": false,
            "mutable": true
          }
        ],
        "password_policy": {
          "minimum_length": 8,
          "require_numbers": true,
          "require_symbols": false,
          "require_uppercase": true,
          "require_lowercase": true
        },
        "mfa": "OPTIONAL",
        "account_recovery": "EMAIL_ONLY"
      },
      "app_client": {
        "name": "ShoppingCartWebClient",
        "generate_secret": false,
        "auth_flows": {
          "user_password": true,
          "user_srp": true
        },
        "oauth": {
          "flows": ["code"],
          "scopes": ["phone", "email", "openid", "profile"],
          "callback_urls": ["http://localhost:8080/", "https://<cloudfront-distribution>.cloudfront.net/"],
          "logout_urls": ["http://localhost:8080/", "https://<cloudfront-distribution>.cloudfront.net/"]
        }
      }
    },
    "frontend_integration": {
      "library": "AWS Amplify",
      "configuration_steps": [
        "Install Amplify libraries: `npm install aws-amplify @aws-amplify/ui-vue`",
        "Configure Amplify in main.js with aws-exports.js",
        "Use AmplifyAuthenticator component for auth views",
        "Use Amplify API module for authenticated requests"
      ],
      "token_handling": "Amplify automatically attaches JWT tokens to API Gateway requests via Authorization header"
    },
    "backend_integration": {
      "api_gateway_authorizer": "COGNITO_USER_POOLS",
      "lambda_validation": "Use Cognito JWT verification via AWS SDK or library"
    }
  },
  "api_gateway_configuration": {
    "api_type": "REST API",
    "design": [
      {
        "path": "/products",
        "method": "GET",
        "lambda_integration": "GetProductsFunction",
        "cors": true,
        "authorization": "NONE"
      },
      {
        "path": "/products/{productId}",
        "method": "GET",
        "lambda_integration": "GetProductFunction",
        "cors": true,
        "authorization": "NONE"
      },
      {
        "path": "/cart",
        "method": "GET",
        "lambda_integration": "ListCartFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      },
      {
        "path": "/cart",
        "method": "POST",
        "lambda_integration": "AddToCartFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      },
      {
        "path": "/cart/{productId}",
        "method": "PUT",
        "lambda_integration": "UpdateCartFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      },
      {
        "path": "/cart/migrate",
        "method": "POST",
        "lambda_integration": "MigrateCartFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      },
      {
        "path": "/cart/checkout",
        "method": "POST",
        "lambda_integration": "CheckoutCartFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      },
      {
        "path": "/cart/{productId}/total",
        "method": "GET",
        "lambda_integration": "GetCartTotalFunction",
        "cors": true,
        "authorization": "COGNITO_USER_POOLS"
      }
    ],
    "cors_settings": {
      "allow_origins": ["http://localhost:8080", "https://<cloudfront-distribution>.cloudfront.net"],
      "allow_methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allow_headers": ["Content-Type", "Authorization", "X-Amz-Date", "X-Api-Key", "X-Amz-Security-Token"],
      "allow_credentials": true
    },
    "stages": ["dev", "prod