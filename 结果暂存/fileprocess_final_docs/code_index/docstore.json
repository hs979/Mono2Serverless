{"docstore/metadata": {"66c540c4-79ae-4344-9f11-e29c9272342c": {"doc_hash": "66c5ff8fa250d14049d1fb878488e355a0214d524609ecc25bfb6375c9407bae"}, "f02a9299-aab9-40c1-9532-712c470ef5b3": {"doc_hash": "04e803a1960e78f4f4028ca0c715ad7b35981fe392b6f587236b2168a4855904"}, "98bdca78-e8e8-4007-9148-7d5bda6589e9": {"doc_hash": "666896f51027a920d1528db4c7ea22dfb11f41410386e0ada4963dcb8fc362f1"}, "20197c20-32d8-4eee-9b26-4f059f804eea": {"doc_hash": "8c411779b20a7f940760d4de11c7bf3f18ed16ad28852c20a48a891a1f829e72"}, "41e87c38-15d2-47d4-bd87-e3ba23af5772": {"doc_hash": "507273b9da1e8fe86d2d30d76771f1b9e04c8f9fabf7bcf51cd5a20cff925250", "ref_doc_id": "66c540c4-79ae-4344-9f11-e29c9272342c"}, "2d3ef4df-ca34-4fc0-b3c3-36500fa945b0": {"doc_hash": "ab17be3b8aa4f6e52dfab0884f66fdc133517c0c017d5830003a0945c56a5200", "ref_doc_id": "f02a9299-aab9-40c1-9532-712c470ef5b3"}, "d7ae35fe-eedc-4795-97d6-5f38a8dbdd72": {"doc_hash": "a2d37ba2fd0828476e800f97ceea516f880f6f59d462188470936ba7e8d4dcd3", "ref_doc_id": "98bdca78-e8e8-4007-9148-7d5bda6589e9"}, "abcfb252-0442-41ae-bb5b-a7f8f57840f5": {"doc_hash": "d11994dab943d660ff344342d267dda9f2fea685cd9de5f258d593e6c8249b85", "ref_doc_id": "20197c20-32d8-4eee-9b26-4f059f804eea"}}, "docstore/ref_doc_info": {"66c540c4-79ae-4344-9f11-e29c9272342c": {"node_ids": ["41e87c38-15d2-47d4-bd87-e3ba23af5772"], "metadata": {"file_path": "database.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 50}}, "f02a9299-aab9-40c1-9532-712c470ef5b3": {"node_ids": ["2d3ef4df-ca34-4fc0-b3c3-36500fa945b0"], "metadata": {"file_path": "init_dynamodb.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 118}}, "98bdca78-e8e8-4007-9148-7d5bda6589e9": {"node_ids": ["d7ae35fe-eedc-4795-97d6-5f38a8dbdd72"], "metadata": {"file_path": "main.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 76}}, "20197c20-32d8-4eee-9b26-4f059f804eea": {"node_ids": ["abcfb252-0442-41ae-bb5b-a7f8f57840f5"], "metadata": {"file_path": "processing.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 108}}}, "docstore/data": {"41e87c38-15d2-47d4-bd87-e3ba23af5772": {"__data__": {"id_": "41e87c38-15d2-47d4-bd87-e3ba23af5772", "embedding": null, "metadata": {"file_path": "database.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 50}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "66c540c4-79ae-4344-9f11-e29c9272342c", "node_type": "4", "metadata": {"file_path": "database.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 50}, "hash": "66c5ff8fa250d14049d1fb878488e355a0214d524609ecc25bfb6375c9407bae", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"\"\"\nDynamoDB Data Access Layer\nUsed to save and query sentiment analysis results for file processing\n\nNote: To create the table, please use the init_dynamodb.py script or refer to the README\n\"\"\"\nimport boto3\nimport os\nfrom datetime import datetime\n\n# Get configuration from environment variables, use default values if not set\nTABLE_NAME = os.getenv('DYNAMODB_TABLE_NAME', 'ref-arch-fileprocessing-sentiment')\nAWS_REGION = os.getenv('AWS_REGION', 'us-east-1')\n\n# Initialize DynamoDB resource\ndynamodb = boto3.resource('dynamodb', region_name=AWS_REGION)\n\ndef save_sentiment(filename, sentiment_data):\n    \"\"\"\n    Save AWS Comprehend sentiment analysis results to DynamoDB\n    \n    Parameters\n    ----------\n    filename: str\n        The name of the file being analyzed\n    sentiment_data: dict\n        Dictionary containing sentiment analysis results, must contain 'Sentiment' and 'SentimentScore' keys\n        sentiment_data['Sentiment']: Overall sentiment (POSITIVE/NEGATIVE/NEUTRAL/MIXED)\n        sentiment_data['SentimentScore']: Confidence scores for Positive, Negative, Neutral, Mixed\n    \"\"\"\n    try:\n        table = dynamodb.Table(TABLE_NAME)\n        \n        last_modified = datetime.utcnow().isoformat()\n        response = table.put_item(\n            Item={\n                'filename': filename,\n                'last_modified': last_modified,\n                'overall_sentiment': sentiment_data['Sentiment'],\n                'positive': str(sentiment_data['SentimentScore']['Positive']),\n                'negative': str(sentiment_data['SentimentScore']['Negative']),\n                'neutral': str(sentiment_data['SentimentScore']['Neutral']),\n                'mixed': str(sentiment_data['SentimentScore']['Mixed'])\n            }\n        )\n        \n        print(f\"[Database] Sentiment analysis results saved to DynamoDB: {filename} -> {sentiment_data['Sentiment']}\")\n    except Exception as e:\n        print(f\"[Database Error] Failed to save sentiment analysis results: {e}\")\n        raise", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2001, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2d3ef4df-ca34-4fc0-b3c3-36500fa945b0": {"__data__": {"id_": "2d3ef4df-ca34-4fc0-b3c3-36500fa945b0", "embedding": null, "metadata": {"file_path": "init_dynamodb.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 118}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "f02a9299-aab9-40c1-9532-712c470ef5b3", "node_type": "4", "metadata": {"file_path": "init_dynamodb.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 118}, "hash": "04e803a1960e78f4f4028ca0c715ad7b35981fe392b6f587236b2168a4855904", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"\"\"\nDynamoDB Table Initialization Script\nUsed to create the DynamoDB table required for the file processing application\n\nUsage:\n    python init_dynamodb.py\n\"\"\"\nimport boto3\nimport os\nimport sys\nfrom botocore.exceptions import ClientError\n\nTABLE_NAME = os.getenv('DYNAMODB_TABLE_NAME', 'ref-arch-fileprocessing-sentiment')\nAWS_REGION = os.getenv('AWS_REGION', 'us-east-1')\n\ndef get_dynamodb_client():\n    \"\"\"Get DynamoDB client\"\"\"\n    return boto3.client('dynamodb', region_name=AWS_REGION)\n\ndef table_exists(client, table_name):\n    \"\"\"Check if the table exists\"\"\"\n    try:\n        client.describe_table(TableName=table_name)\n        return True\n    except ClientError as e:\n        if e.response['Error']['Code'] == 'ResourceNotFoundException':\n            return False\n        raise\n\ndef wait_for_table(client, table_name):\n    \"\"\"Wait for the table to become ACTIVE\"\"\"\n    print(f\"  Waiting for table {table_name} to become ACTIVE...\")\n    waiter = client.get_waiter('table_exists')\n    waiter.wait(\n        TableName=table_name,\n        WaiterConfig={\n            'Delay': 2,\n            'MaxAttempts': 30\n        }\n    )\n    print(f\"  \u2713 Table {table_name} is ready\")\n\ndef create_sentiment_table():\n    \"\"\"\n    Create sentiment analysis results table\n    \n    Table Structure:\n    - Primary Key: filename (String) - Partition Key\n    - Attributes: \n        - last_modified: Last modified time\n        - overall_sentiment: Overall sentiment (POSITIVE/NEGATIVE/NEUTRAL/MIXED)\n        - positive: Positive sentiment score\n        - negative: Negative sentiment score\n        - neutral: Neutral sentiment score\n        - mixed: Mixed sentiment score\n    \"\"\"\n    print('\\n========================================')\n    print('File Processing App - DynamoDB Table Initialization')\n    print('========================================')\n    print(f'Region: {AWS_REGION}')\n    print(f'Table Name: {TABLE_NAME}')\n    print('')\n    \n    client = get_dynamodb_client()\n    \n    if table_exists(client, TABLE_NAME):\n        print(f'\u2713 Table already exists: {TABLE_NAME}')\n        print('\\nHint: Table created, you can use the application directly')\n        return\n    \n    print(f'Creating table: {TABLE_NAME}')\n    \n    try:\n        client.create_table(\n            TableName=TABLE_NAME,\n            KeySchema=[\n                {\n                    'AttributeName': 'filename',\n                    'KeyType': 'HASH'  # Partition Key\n                }\n            ],\n            AttributeDefinitions=[\n                {\n                    'AttributeName': 'filename',\n                    'AttributeType': 'S'  # String Type\n                }\n            ],\n            BillingMode='PAY_PER_REQUEST'  # Pay-per-request mode, no throughput specified\n        )\n        \n        wait_for_table(client, TABLE_NAME)\n        \n        print('\\n========================================')\n        print('\u2713 Table initialization completed!')\n        print('========================================')\n        print(f'\\nCreated table:')\n        print(f'  - {TABLE_NAME}')\n        print(f'    Primary Key: filename (String)')\n        print(f'    Billing Mode: PAY_PER_REQUEST')\n        print('\\nHint: You can start the application now!')\n        \n    except ClientError as e:\n        print(f'\\n Failed to create table: {e}')\n        \n        if e.response['Error']['Code'] == 'UnrecognizedClientException':\n            print('Hint: Please check AWS credentials configuration')\n            print('  Method 1: aws configure')\n            print('  Method 2: Set environment variables AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY')\n        elif e.response['Error']['Code'] == 'ResourceInUseException':\n            print('Hint: Table already exists')\n        \n        sys.exit(1)\n    except Exception as e:\n        print(f'\\n Initialization failed: {e}')\n        sys.exit(1)\n\nif __name__ == '__main__':\n    create_sentiment_table()", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3902, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d7ae35fe-eedc-4795-97d6-5f38a8dbdd72": {"__data__": {"id_": "d7ae35fe-eedc-4795-97d6-5f38a8dbdd72", "embedding": null, "metadata": {"file_path": "main.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 76}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "98bdca78-e8e8-4007-9148-7d5bda6589e9", "node_type": "4", "metadata": {"file_path": "main.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 76}, "hash": "666896f51027a920d1528db4c7ea22dfb11f41410386e0ada4963dcb8fc362f1", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import argparse\nimport os\nimport sys\nfrom processing import convert_to_html, analyze_sentiment\nfrom database import save_sentiment\n\ndef main():\n    \"\"\"Main program entry point\"\"\"\n    # Set up command line argument parsing\n    parser = argparse.ArgumentParser(\n        description='File Processing Tool - Convert Markdown files to HTML and perform sentiment analysis'\n    )\n    parser.add_argument(\n        'file',\n        type=str,\n        help='Path to the Markdown file to process (e.g., sample.md)'\n    )\n    \n    args = parser.parse_args()\n    input_file = args.file\n    \n    if not os.path.exists(input_file):\n        print(f\"[Error] File not found: {input_file}\")\n        sys.exit(1)\n    \n    if not (input_file.endswith('.md') or input_file.endswith('.markdown')):\n        print(f\"[Warning] File does not seem to be in Markdown format (.md/.markdown), but processing will continue\")\n    \n    print(\"=\" * 60)\n    print(\"File Processing Tool\")\n    print(\"=\" * 60)\n    print(f\"Processing file: {input_file}\")\n    print()\n    \n    print(\"-\" * 60)\n    print(\"Feature 1: Format Conversion (Markdown -> HTML)\")\n    print(\"-\" * 60)\n    try:\n        html_file = convert_to_html(input_file)\n        print()\n    except Exception as e:\n        print(f\"[Fatal Error] Format conversion failed, program terminated\")\n        sys.exit(1)\n\n    print(\"-\" * 60)\n    print(\"Feature 2: Sentiment Analysis\")\n    print(\"-\" * 60)\n    try:\n        sentiment_data = analyze_sentiment(input_file)\n        print()\n    except Exception as e:\n        print(f\"[Fatal Error] Sentiment analysis failed, program terminated\")\n        sys.exit(1)\n    \n    # Save sentiment analysis results to database\n    print(\"-\" * 60)\n    print(\"Saving results to database\")\n    print(\"-\" * 60)\n    try:\n        filename = os.path.basename(input_file)\n        save_sentiment(filename, sentiment_data)\n        print()\n    except Exception as e:\n        print(f\"[Fatal Error] Failed to save results, program terminated\")\n        sys.exit(1)\n    \n    # Complete\n    print(\"=\" * 60)\n    print(\"Processing completed!\")\n    print(\"=\" * 60)\n    print(f\"HTML File: {html_file}\")\n    print(f\"Sentiment Results: Saved to DynamoDB database\")\n    print()\n\nif __name__ == '__main__':\n    main()", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2238, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "abcfb252-0442-41ae-bb5b-a7f8f57840f5": {"__data__": {"id_": "abcfb252-0442-41ae-bb5b-a7f8f57840f5", "embedding": null, "metadata": {"file_path": "processing.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 108}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "20197c20-32d8-4eee-9b26-4f059f804eea", "node_type": "4", "metadata": {"file_path": "processing.py", "function_name": "whole_file", "type": "file", "start_line": 1, "end_line": 108}, "hash": "8c411779b20a7f940760d4de11c7bf3f18ed16ad28852c20a48a891a1f829e72", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import os\nimport markdown\nimport boto3\n\ndef convert_to_html(input_filepath, output_dir='output/html'):\n    \"\"\"\n    Convert Markdown file to HTML file\n    \n    Parameters\n    ----------\n    input_filepath: str\n        Path to the input Markdown file\n    output_dir: str\n        Directory for output HTML files, default is 'output/html'\n    \n    Returns\n    -------\n    str\n        Path to the generated HTML file\n    \"\"\"\n    try:\n        os.makedirs(output_dir, exist_ok=True)\n\n        with open(input_filepath, 'r', encoding='utf-8') as f:\n            markdown_text = f.read()\n\n        html_content = markdown.markdown(markdown_text)\n\n        filename = os.path.basename(input_filepath)\n        html_filename = os.path.splitext(filename)[0] + '.html'\n        output_filepath = os.path.join(output_dir, html_filename)\n\n        with open(output_filepath, 'w', encoding='utf-8') as f:\n            f.write(html_content)\n        \n        print(f\"[Format Conversion] Conversion successful: {filename} -> {html_filename}\")\n        print(f\"[Format Conversion] HTML file saved to: {output_filepath}\")\n        \n        return output_filepath\n    \n    except FileNotFoundError:\n        print(f\"[Format Conversion Error] File not found: {input_filepath}\")\n        raise\n    except Exception as e:\n        print(f\"[Format Conversion Error] Conversion failed: {e}\")\n        raise\n\ndef analyze_sentiment(input_filepath):\n    \"\"\"\n    Analyze text file sentiment using AWS Comprehend\n    \n    Parameters\n    ----------\n    input_filepath: str\n        Path to the input text file\n    \n    Returns\n    -------\n    dict\n        Dictionary containing sentiment analysis results, including:\n        - Sentiment: Overall sentiment (POSITIVE/NEGATIVE/NEUTRAL/MIXED)\n        - SentimentScore: Confidence scores for each sentiment\n            - Positive: Positive sentiment score (between 0 and 1)\n            - Negative: Negative sentiment score (between 0 and 1)\n            - Neutral: Neutral sentiment score (between 0 and 1)\n            - Mixed: Mixed sentiment score (between 0 and 1)\n    \"\"\"\n    try:\n        with open(input_filepath, 'r', encoding='utf-8') as f:\n            text = f.read()\n\n        if len(text.encode('utf-8')) > 5000:\n            print(f\"[Sentiment Analysis Warning] Text too long, truncating to first 5000 bytes\")\n            while len(text.encode('utf-8')) > 5000:\n                text = text[:-100]\n        \n        aws_region = os.getenv('AWS_REGION', 'us-east-1')\n        comprehend_client = boto3.client('comprehend', region_name=aws_region)\n        \n        # Use AWS Comprehend for sentiment analysis\n        response = comprehend_client.detect_sentiment(\n            Text=text,\n            LanguageCode='en'\n        )\n        \n        overall_sentiment = response['Sentiment']\n        sentiment_score = response['SentimentScore']\n        \n        sentiment_data = {\n            'Sentiment': overall_sentiment,\n            'SentimentScore': sentiment_score\n        }\n        \n        print(f\"[Sentiment Analysis] Analysis completed\")\n        print(f\"[Sentiment Analysis] Overall Sentiment: {overall_sentiment}\")\n        print(f\"[Sentiment Analysis] Sentiment Scores: Positive={sentiment_score['Positive']:.3f}, \"\n              f\"Negative={sentiment_score['Negative']:.3f}, \"\n              f\"Neutral={sentiment_score['Neutral']:.3f}, \"\n              f\"Mixed={sentiment_score['Mixed']:.3f}\")\n        \n        return sentiment_data\n    \n    except FileNotFoundError:\n        print(f\"[Sentiment Analysis Error] File not found: {input_filepath}\")\n        raise\n    except Exception as e:\n        print(f\"[Sentiment Analysis Error] Analysis failed: {e}\")\n        raise", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3671, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}}}